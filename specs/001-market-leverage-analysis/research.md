# 市场杠杆分析系统 - 技术研究报告

**创建日期**: 2025-01-10
**研究目的**: 评估数据源获取策略、技术架构和实现方案

## 数据源分析

### 1. FINRA融资余额数据
- **数据覆盖**: 1997年1月至今（Part1核心指标）
- **数据频率**: 月度发布
- **获取策略**: 混合策略 - 主要使用预置数据源，FINRA API作为备用
- **特殊处理**: 需要数据清洗和格式标准化
- **覆盖要求**: 95%以上覆盖率

### 2. FRED经济数据
- **利率数据**: 联邦基金利率、10年期国债收益率
- **M2货币供应**: 月度数据，用于货币供应比率计算
- **API限制**: 120次/分钟，需要合理的请求频率控制
- **历史覆盖**: 1950年代至今，完全满足分析需求

### 3. Yahoo Finance市场数据
- **S&P 500指数**: 历史价格和市值数据
- **VIX波动率指数**: 1990年至今的恐慌情绪指标
- **数据频率**: 日度数据
- **API限制**: 30次/分钟，需要批量获取优化

### 4. 数据时间覆盖策略
- **Part1指标**: 1997-01至今（基础杠杆分析）
- **Part2指标**: 2010-02至2025-09（高级风险分析）
- **覆盖率目标**: 两个时间段均需达到95%以上

## 技术架构建议

### 1. 数据获取层
```python
# 核心数据源管理器
class IntegratedDataSource:
    def __init__(self):
        self.finra_source = FINRADataSource()
        self.fred_source = FREDDataSource()
        self.yahoo_source = YahooFinanceDataSource()

    def fetch_all_data(self, start_date, end_date):
        # 并发获取多源数据
        pass
```

### 2. 数据处理层
- **数据清洗**: 缺失值处理、异常值检测、数据格式标准化
- **指标计算**: 杠杆率、变化率、Z-score等衍生指标
- **质量控制**: 99.9%准确率要求，自动验证机制

### 3. 分析引擎层
- **脆弱性指数**: 杠杆Z-score - VIX Z-score（集成用户算法文案）
- **风险信号**: 多维度风险评估和预警
- **历史对比**: 与历史危机时期的模式匹配

### 4. 可视化层
- **Streamlit框架**: 快速原型和交互式界面
- **Plotly图表**: 时间序列、散点图、热力图
- **响应式设计**: 支持时间范围选择和数据过滤

## 性能和可扩展性

### 1. 数据缓存策略
- **本地缓存**: 避免重复API调用
- **增量更新**: 只获取新数据，提高效率
- **数据版本**: 支持数据回滚和历史重现

### 2. 并发处理
- **异步IO**: 提高数据获取效率
- **批量处理**: 减少API调用次数
- **错误重试**: 网络故障自动恢复

### 3. 内存优化
- **分块处理**: 大数据集分块加载
- **懒加载**: 按需加载历史数据
- **垃圾回收**: 及时释放内存资源

## 风险识别策略

### 1. 核心指标阈值
- **杠杆率异常**: 超过历史75%分位数
- **变化率警告**: YoY增长>15%或<-10%
- **脆弱性指数**: 基于Z-score差值的风险等级

### 2. 历史危机模式
- **互联网泡沫**: 1999-2000年
- **金融危机**: 2007-2009年
- **疫情冲击**: 2020年
- **高通胀时期**: 2021-2023年

### 3. 实时监控
- **数据更新延迟**: <30分钟
- **系统可用性**: >99.5%
- **响应时间**: <2秒

## 实现优先级

### 高优先级 (P1)
1. 数据获取基础设施
2. 核心指标计算引擎
3. 基础可视化功能
4. 脆弱性指数实现

### 中优先级 (P2)
1. 历史危机对比分析
2. 交互式图表增强
3. 报告生成功能
4. 性能优化

### 低优先级 (P3)
1. 高级统计分析
2. 机器学习预测
3. 移动端适配
4. 多语言支持

## 可视化架构设计

### 基于7个核心指标的图表设计 (根据docs/tableElements.md)

#### 1. 市场杠杆率图表
- **双Y轴时间序列图**:
  - X轴: 时间轴
  - 左Y轴: 市场杠杆率 (%) - `Margin Debt / S&P 500 总市值`
  - 右Y轴: S&P 500指数数值
- **实现方式**: Plotly双轴图表，支持交互式缩放和悬停
- **关键特性**: 突出显示杠杆率与指数走势的相关性

#### 2. 货币供应比率图表
- **单Y轴时间序列图**:
  - X轴: 时间轴
  - 左Y轴: 货币供应比率 (%) - `Margin Debt / M2`
- **实现方式**: Plotly线图，添加历史均值线
- **关键特性**: 标记异常点和趋势变化

#### 3. 利率成本分析图表
- **双Y轴时间序列图**:
  - X轴: 时间轴
  - 左Y轴: `Margin Debt 年同比变化率` (%)
  - 右Y轴: 利率 (%)
- **实现方式**: Plotly双轴图，不同颜色区分指标
- **关键特性**: 分析利率变化对融资余额的影响

#### 4. 杠杆变化率图表
- **双Y轴时间序列图**:
  - X轴: 时间轴
  - 左Y轴: 杠杆净值年变化率 (%)
  - 右Y轴: 市场回报年变化率 (%)
- **实现方式**: Plotly双轴图，支持相关性分析
- **关键特性**: 展示杠杆变化与市场回报的关系

#### 5. 投资者净资产图表
- **单Y轴时间序列图**:
  - X轴: 时间轴
  - 左Y轴: `Leverage_Net` (杠杆净值) - `D - (CC + CM)`
- **实现方式**: Plotly面积图，突出显示正负区间
- **关键特性**: 显示市场缓冲垫的充足性

#### 6. 脆弱性指数图表
- **单Y轴时间序列图**:
  - X轴: 时间轴
  - 左Y轴: 脆弱性指数 - `杠杆Z分数 - VIX Z分数`
- **实现方式**: Plotly线图 + 阈值线
- **关键特性**:
  - 标记 >3 的泡沫风险区域
  - 标记 <-3 的极度恐慌区域
  - 突出显示 -1 到 +1 的健康区间

#### 7. VIX 和 杠杆图表 (新增)
- **双Y轴时间序列图**:
  - X轴: 时间轴
  - 左Y轴: VIX_t (VIX波动率)
  - 右Y轴: Leverage_Normalized_t (标准化杠杆)
- **实现方式**: Plotly双轴图
- **关键特性**: 展示VIX与杠杆标准化指标的相关性

## 结论

基于研究分析，建议采用分层架构设计，优先实现数据获取和核心分析功能。技术栈选择Python+Streamlit+Plotly能够快速构建原型并满足交互式分析需求。数据源采用混合策略既保证了数据质量又控制了API成本。

结合新增文档分析，系统将基于用户提供的margin-statistics.csv数据，实现7个核心指标的动态可视化展示。所有数据源均为免费获取，无需API Key，确保系统的可持续性和易部署性。